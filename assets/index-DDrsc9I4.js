import c from"https://cdn.jsdelivr.net/npm/@line/liff@2.23.2/+esm";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();const a="https://script.google.com/macros/s/AKfycby58aoJJ7ml_6Xmh_EzirrPxNnqscbMjPU24ZDc0abyrAGGXNgnFehPFaluBaHoXmgXyA/exec",l="https://script.google.com/macros/s/AKfycbyztna3JATsl16tEPwFKIJgZm1GGsFAGS0bI-pAvFdPjnaTuTzNnSqHK8QPHL7Xyz8e/exec";async function u(){try{await c.init({liffId:"2009177086-5AGq54Qb"}),c.isLoggedIn()?m():c.login()}catch(n){console.error("LIFF 初始化失敗",n),document.getElementById("loadingView").innerText="系統初始化失敗，請稍後再試"}}async function m(){try{const n=await c.getProfile(),s=n.userId,o=await(await fetch(`${a}?userid=${s}`)).json();document.getElementById("loadingView").classList.add("hidden"),o.isBound?(document.getElementById("userName").innerText=`你好，${n.displayName}！`,document.getElementById("boundView").classList.remove("hidden"),fetch(`${l}?uid=${s}`).then(e=>e.json()).then(e=>{e.status==="success"&&(document.getElementById("subscriptionDuration").innerText=`訂閱 ${e.duration}`)}).catch(()=>{})):document.getElementById("unboundView").classList.remove("hidden")}catch(n){console.error("檢查狀態失敗",n),document.getElementById("loadingView").classList.add("hidden"),document.getElementById("unboundView").classList.remove("hidden")}}async function f(){const n=document.getElementById("submitBtn"),s=document.getElementById("orderId").value,r=document.getElementById("mobile").value,o=document.getElementById("statusMsg");if(!s||!r){Swal.fire("提醒","請填寫訂單編號與手機號碼","warning");return}n.disabled=!0,o.innerText="正在驗證資訊...";const e=await c.getProfile(),t=new URLSearchParams;t.append("orderId",s),t.append("mobile",r),t.append("userid",e.userId),t.append("displayName",e.displayName),t.append("pictureUrl",e.pictureUrl);try{const d=await(await fetch(a,{method:"POST",body:t})).json();d.status===200?Swal.fire({title:"成功！",text:"訂單綁定成功",icon:"success",confirmButtonColor:"#be9f74"}).then(()=>{location.reload()}):(Swal.fire("綁定失敗",d.message,"error"),o.innerText=d.message,n.disabled=!1)}catch{Swal.fire("連線異常","請稍後再試","error"),n.disabled=!1}}document.getElementById("submitBtn").addEventListener("click",f);u();
