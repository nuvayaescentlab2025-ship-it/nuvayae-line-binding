import d from"https://cdn.jsdelivr.net/npm/@line/liff@2.23.2/+esm";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const a="https://script.google.com/macros/s/AKfycby58aoJJ7ml_6Xmh_EzirrPxNnqscbMjPU24ZDc0abyrAGGXNgnFehPFaluBaHoXmgXyA/exec";async function l(){try{await d.init({liffId:"2009177086-5AGq54Qb"}),d.isLoggedIn()?u():d.login()}catch(n){console.error("LIFF 初始化失敗",n),document.getElementById("loadingView").innerText="系統初始化失敗，請稍後再試"}}async function u(){try{const n=await d.getProfile(),r=n.userId,o=await(await fetch(`${a}?userid=${r}`)).json();if(o.isBound){document.getElementById("subscriptionDuration").innerText=`訂閱 ${o.duration}`;const e=o.months,t=12,s=t-e;document.getElementById("currentMonth").textContent=e,document.getElementById("remainingMonths").textContent=s,document.getElementById("progressFill").style.width=`${e/t*100}%`,document.querySelector(".progress-card").classList.remove("hidden"),document.getElementById("loadingView").classList.add("hidden"),document.getElementById("userName").innerText=`你好，${n.displayName}！`,document.getElementById("boundView").classList.remove("hidden")}else document.getElementById("loadingView").classList.add("hidden"),document.getElementById("unboundView").classList.remove("hidden")}catch(n){console.error("檢查狀態失敗",n),document.getElementById("loadingView").classList.add("hidden"),document.getElementById("unboundView").classList.remove("hidden")}}async function m(){const n=document.getElementById("submitBtn"),r=document.getElementById("orderId").value,i=document.getElementById("mobile").value,o=document.getElementById("statusMsg");if(!r||!i){Swal.fire("提醒","請填寫訂單編號與手機號碼","warning");return}n.disabled=!0,o.innerText="正在驗證資訊...";const e=await d.getProfile(),t=new URLSearchParams;t.append("orderId",r),t.append("mobile",i),t.append("userid",e.userId),t.append("displayName",e.displayName),t.append("pictureUrl",e.pictureUrl);try{const c=await(await fetch(a,{method:"POST",body:t})).json();c.status===200?Swal.fire({title:"成功！",text:"訂單綁定成功",icon:"success",confirmButtonColor:"#be9f74"}).then(()=>{location.reload()}):(Swal.fire("綁定失敗",c.message,"error"),o.innerText=c.message,n.disabled=!1)}catch{Swal.fire("連線異常","請稍後再試","error"),n.disabled=!1}}document.getElementById("submitBtn").addEventListener("click",m);l();
