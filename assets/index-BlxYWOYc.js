import i from"https://cdn.jsdelivr.net/npm/@line/liff@2.23.2/+esm";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const d of e.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function s(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(t){if(t.ep)return;t.ep=!0;const e=s(t);fetch(t.href,e)}})();const a="https://script.google.com/macros/s/AKfycby58aoJJ7ml_6Xmh_EzirrPxNnqscbMjPU24ZDc0abyrAGGXNgnFehPFaluBaHoXmgXyA/exec";async function l(){try{await i.init({liffId:"2009177086-5AGq54Qb"}),i.isLoggedIn()?u():i.login()}catch(n){console.error("LIFF 初始化失敗",n),document.getElementById("loadingView").innerText="系統初始化失敗，請稍後再試"}}async function u(){const n=await i.getProfile(),r=n.userId;try{const o=await(await fetch(`${a}?userid=${r}`)).json();document.getElementById("loadingView").classList.add("hidden"),o.isBound?(document.getElementById("userName").innerText=`你好，${n.displayName}！`,document.getElementById("boundView").classList.remove("hidden")):document.getElementById("unboundView").classList.remove("hidden")}catch(s){console.error("檢查狀態失敗",s),document.getElementById("loadingView").classList.add("hidden"),document.getElementById("unboundView").classList.remove("hidden")}}async function m(){const n=document.getElementById("submitBtn"),r=document.getElementById("orderId").value,s=document.getElementById("statusMsg");if(!r)return alert("請輸入訂單編號");n.disabled=!0,s.innerText="正在驗證訂單...";const o=await i.getProfile(),t=i.getDecodedIDToken()?i.getDecodedIDToken().email:"未授權",e=new URLSearchParams;e.append("orderId",r),e.append("userid",o.userId),e.append("displayName",o.displayName),e.append("pictureUrl",o.pictureUrl),e.append("email",t);try{const c=await(await fetch(a,{method:"POST",body:e})).json();c.status===200?(alert("✅ 綁定成功！"),location.reload()):(alert("❌ 錯誤："+c.message),s.innerText=c.message,n.disabled=!1)}catch(d){console.error(d),alert("系統連線異常，請稍後再試"),n.disabled=!1}}document.getElementById("submitBtn").addEventListener("click",m);l();
