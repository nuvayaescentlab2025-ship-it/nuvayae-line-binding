import d from"https://cdn.jsdelivr.net/npm/@line/liff@2.23.2/+esm";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const s of e.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function c(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function r(t){if(t.ep)return;t.ep=!0;const e=c(t);fetch(t.href,e)}})();const a="https://script.google.com/macros/s/AKfycby58aoJJ7ml_6Xmh_EzirrPxNnqscbMjPU24ZDc0abyrAGGXNgnFehPFaluBaHoXmgXyA/exec",u="https://script.google.com/macros/s/AKfycbyztna3JATsl16tEPwFKIJgZm1GGsFAGS0bI-pAvFdPjnaTuTzNnSqHK8QPHL7Xyz8e/exec";async function m(){try{await d.init({liffId:"2009177086-5AGq54Qb"}),d.isLoggedIn()?f():d.login()}catch(n){console.error("LIFF 初始化失敗",n),document.getElementById("loadingView").innerText="系統初始化失敗，請稍後再試"}}async function f(){try{const n=await d.getProfile(),o=n.userId;if((await(await fetch(`${a}?userid=${o}`)).json()).isBound){try{const e=await(await fetch(`${u}?uid=${o}`)).json();if(e.status==="success"){document.getElementById("subscriptionDuration").innerText=`訂閱 ${e.duration}`;const s=e.months,i=12,l=i-s;document.getElementById("currentMonth").textContent=s,document.getElementById("remainingMonths").textContent=l,document.getElementById("progressFill").style.width=`${s/i*100}%`,document.querySelector(".progress-card").classList.remove("hidden")}else document.getElementById("subscriptionDuration").innerText="查詢異常，請洽詢官方LINE帳號"}catch{document.getElementById("subscriptionDuration").innerText="查詢異常，請洽詢官方LINE帳號"}document.getElementById("loadingView").classList.add("hidden"),document.getElementById("userName").innerText=`你好，${n.displayName}！`,document.getElementById("boundView").classList.remove("hidden")}else document.getElementById("loadingView").classList.add("hidden"),document.getElementById("unboundView").classList.remove("hidden")}catch(n){console.error("檢查狀態失敗",n),document.getElementById("loadingView").classList.add("hidden"),document.getElementById("unboundView").classList.remove("hidden")}}async function g(){const n=document.getElementById("submitBtn"),o=document.getElementById("orderId").value,c=document.getElementById("mobile").value,r=document.getElementById("statusMsg");if(!o||!c){Swal.fire("提醒","請填寫訂單編號與手機號碼","warning");return}n.disabled=!0,r.innerText="正在驗證資訊...";const t=await d.getProfile(),e=new URLSearchParams;e.append("orderId",o),e.append("mobile",c),e.append("userid",t.userId),e.append("displayName",t.displayName),e.append("pictureUrl",t.pictureUrl);try{const i=await(await fetch(a,{method:"POST",body:e})).json();i.status===200?Swal.fire({title:"成功！",text:"訂單綁定成功",icon:"success",confirmButtonColor:"#be9f74"}).then(()=>{location.reload()}):(Swal.fire("綁定失敗",i.message,"error"),r.innerText=i.message,n.disabled=!1)}catch{Swal.fire("連線異常","請稍後再試","error"),n.disabled=!1}}document.getElementById("submitBtn").addEventListener("click",g);m();
