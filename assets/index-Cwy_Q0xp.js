import c from"https://cdn.jsdelivr.net/npm/@line/liff@2.23.2/+esm";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const l="https://script.google.com/macros/s/AKfycby58aoJJ7ml_6Xmh_EzirrPxNnqscbMjPU24ZDc0abyrAGGXNgnFehPFaluBaHoXmgXyA/exec";async function a(){try{await c.init({liffId:"2009177086-5AGq54Qb"}),c.isLoggedIn()?u():c.login()}catch(n){console.error("LIFF 初始化失敗",n),document.getElementById("loadingView").innerText="系統初始化失敗，請稍後再試"}}async function u(){const n=await c.getProfile(),o=n.userId;try{const r=await(await fetch(`${l}?userid=${o}`)).json();document.getElementById("loadingView").classList.add("hidden"),r.isBound?(document.getElementById("userName").innerText=`你好，${n.displayName}！`,document.getElementById("boundView").classList.remove("hidden")):document.getElementById("unboundView").classList.remove("hidden")}catch{document.getElementById("loadingView").classList.add("hidden"),document.getElementById("unboundView").classList.remove("hidden")}}async function m(){const n=document.getElementById("submitBtn"),o=document.getElementById("orderId").value,i=document.getElementById("mobile").value,r=document.getElementById("statusMsg");if(!o||!i){Swal.fire({title:"提醒",text:"請完整填寫訂單編號與手機號碼",icon:"warning",confirmButtonColor:"#be9f74"});return}n.disabled=!0,r.innerText="正在驗證資訊...";const e=await c.getProfile(),t=new URLSearchParams;t.append("orderId",o),t.append("mobile",i),t.append("userid",e.userId),t.append("displayName",e.displayName),t.append("pictureUrl",e.pictureUrl);try{const d=await(await fetch(l,{method:"POST",body:t})).json();d.status===200?Swal.fire({title:"成功！",text:"訂單綁定成功",icon:"success",confirmButtonColor:"#be9f74",confirmButtonText:"確定"}).then(()=>{location.reload()}):(Swal.fire({title:"綁定失敗",text:d.message,icon:"error",confirmButtonColor:"#be9f74"}),r.innerText=d.message,n.disabled=!1)}catch{Swal.fire({title:"連線異常",text:"請確認網路狀態後再試一次",icon:"error",confirmButtonColor:"#be9f74"}),n.disabled=!1}}document.getElementById("submitBtn").addEventListener("click",m);a();
